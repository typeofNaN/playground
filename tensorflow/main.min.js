async function getCamera(){try{const e=await navigator.mediaDevices.getUserMedia({video:!0});video.srcObject=e}catch(e){console.log(e)}}async function loadModels(){await faceapi.loadTinyFaceDetectorModel(MODEL_PATH),await faceapi.loadFaceLandmarkTinyModel(MODEL_PATH),await faceapi.loadFaceExpressionModel(MODEL_PATH),await faceapi.loadAgeGenderModel(MODEL_PATH),getCamera()}function detectFace(){const e=faceapi.createCanvasFromMedia(video),a=e.getContext("2d"),{width:t,height:d}=video;document.body.append(e),setInterval(async()=>{const i=await faceapi.detectAllFaces(video,new faceapi.TinyFaceDetectorOptions).withFaceLandmarks(!0).withFaceExpressions().withAgeAndGender(),c=faceapi.resizeResults(i,{width:t,height:d});a.clearRect(0,0,t,d),faceapi.draw.drawFaceLandmarks(e,c),c.forEach(a=>{const{age:t,gender:d,genderProbability:i}=a;new faceapi.draw.DrawTextField([`${"male"===d?"男":"女"} ${~~t} 岁`],a.detection.box.bottomLeft).draw(e)})},300)}const MODEL_PATH="./models",video=document.getElementById("video");video.addEventListener("play",detectFace),loadModels();